# 多机房模式

## 多机房模式

这种模式主要解决不同地区高性能、高可用的问题。 随着应用用户不断的增加，用户群体分布在全球各地，如果把服务器部署在一个地方，一个机房，比如北京，那么美国的用户使用应用的时候就会特别慢，因为每一个请求都需要通过海底光缆走上个那么一秒钟\(预估\)左右，这样对用户体验及其不好。怎么办？使用多机房部署。

### 模式架构图

 这种模式的一般设计见下图：

![](../../.gitbook/assets/image%20%28135%29.png)

如上图所示，一个典型的用户请求流程如下：

用户请求一个链接A通过DNS智能解析到离用户最近的机房B使用B机房服务链接A

是不是觉得很简单，没啥？其实这里面的问题没有表面这么简单，下面一一道来。

首先是数据同步问题，在中国产生的数据要同步到美国，美国的也一样，数据同步就会涉及数据版本、一致性、更新丢弃、删除等问题。

其次是一地多机房的请求路由问题，典型的是如上图，中国的北京机房和杭州机房，如果北京机房挂了，那么要能够通过路由把所有发往北京机房的请求转发到杭州机房。异地也存在这个问题。所以，多机房模式，也就是异地多活并不是那么的简单。

### 模式优缺点

该总结一下这种模式的优缺点的了，如下：

* 优点：高可用、高性能、异地多活。
* 缺点：数据同步、数据一致性、请求路由。

