# 服务熔断设计

## 服务熔断的目的

在微服务系统下，随着调用次数的增加，一个微小的错误可能会不断被链路放大，导致整体服务不可用。

当下游的服务因为某种原因突然**变得不可用**或**响应过慢**，上游服务为了保证自己整体服务的可用性，不再继续调用目标服务，直接返回，快速释放资源。如果目标服务情况好转则恢复调用。

直接返回

* 返回默认值
* 返回自定义fall back，尽量集成rpc客户端，实现接口粒度隔离

恢复调用

* 服务熔断后通过预先设定的时间窗口之后，对于真实的请求，系统给予响应之后会探测下游服务是否可用，然后根据探测的结果判断下游服务是否可用。

## 开源方案

### Hystrix

需要通过command的方式书写，对业务入侵大

### rpc客户端+服务治理平台

通过rpc客户端和服务治理平台实现服务的熔断，客户端访问proxy，proxy用来代理真实的服务。

## 熔断方案整体交互流程

![](../.gitbook/assets/image%20%28166%29.png)

## rpc客户端fallback流程

![](../.gitbook/assets/image%20%28167%29.png)



