# 服务无状态设计

## 无状态化定义

无状态我们之前在高可用设计中做了一些简要的介绍，这里再回顾一下。所谓的无状态化就是在冗余部署的多个服务要完全对等，每一次请求提交到冗余部署的服务处理后的结果要完全一致。这就要求模块不能存储业务的上下文信息，例如网关如果存储用户session的话就没办法保证所有的数据是完全一致的。

## 无状态化的目的

* 服务的快速扩容
* 服务的弹性缩容

## 实战

在分布式的系统中如何存储用户的session，如果直接存放在网关层就无法保证多个网关之间的session是完全一致的，如果一个网关重启此时没有任何的缓存数据，这时它与其他网关就是数据不一致的，也就无法保证服务的无状态化了。

此时我们可以将用户的session数据进行统一的存储，可以做一个存储的集群，然后根据hash将用户数据分散到不同的存储服务器当中。如果我们不想网关对用户进行hash处理我们也可以采用将存储集群与hash计算集成，类似与[codis](https://github.com/CodisLabs/codis)框架。



